<div class="container mt-5">
    <div style="background-color: #001968; padding: 20px; color: white;" class="mb-5">
        <div class="text-center mb-4">
            <h1 class="font-weight-bold" style="color: white;">Enrollment Schedules</h1>
            <p>Enroll and apply now</p>
        </div>

        <form method="GET" class="mb-4">
            <div class="form-row">
                <div class="form-group col-md-12">
                    <label for="schoolYearFilter">Filter by School Year:</label>
                    <select id="schoolYearFilter" name="school_year" class="form-control">
                        <option value="">All School Year</option>
                        <?php foreach ($school_years as $school_year) : ?>
                            <option value="<?= htmlspecialchars($school_year['school_year']) ?>" <?= $filter_school_year == $school_year['school_year'] ? 'selected' : '' ?>>
                                <?= htmlspecialchars($school_year['school_year']) ?>
                            </option>
                        <?php endforeach; ?>
                    </select>
                </div>
            </div>
            <div class="d-flex justify-content-end" style="gap: 5px;">
                <button type="submit" class="btn btn-primary">Filter</button>
                <a href="enrollment_schedules.php" class="btn btn-secondary">Reset</a>
            </div>
        </form>
    </div>

    <!-- Display Schedules in a Table -->
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>School Year</th>
                    <th>Semester</th>
                    <th>Schedule Upload</th>
                    <th>Created At</th>
                    <th>Updated At</th>
                </tr>
            </thead>
            <tbody>
                <?php if ($schedules) : ?>
                    <?php foreach ($schedules as $schedule) : ?>
                        <tr>
                            <td><?= htmlspecialchars($schedule['school_year']) ?></td>
                            <td><?= htmlspecialchars($schedule['semester']) ?></td>
                            <td><a href="assets/uploads/enrollment_schedules/<?= htmlspecialchars($schedule['schedule_upload']) ?>" target="_blank">View Schedule</a></td>
                            <td><?= htmlspecialchars($schedule['created_at']) ?></td>
                            <td><?= htmlspecialchars($schedule['updated_at']) ?></td>
                        </tr>
                    <?php endforeach; ?>
                <?php else : ?>
                    <tr>
                        <td colspan="5" class="text-center">No schedules found</td>
                    </tr>
                <?php endif; ?>
            </tbody>
        </table>
    </div>

</div>

<!-- Reuse Footer -->
<div id="footer" class="footer pt-3 pb-2" style="background-color: #001968">
    <div class="container">
        <div class="text-white">
            <div class="row">
                <div class="col-md-8">
                    <p style="font-family: CENTURY GOTHIC; font-size: 10px;">
                    <table style="width: 100%; font-family: CENTURY GOTHIC; font-size: 10px; ">
                        <tr valign="top">
                            <td style="text-align: center;">
                                <i class="fas fa-map-marker-alt" style="font-size:16px; color: #fff"></i>
                            </td>
                            <td>
                                <font style="font-family: CENTURY GOTHIC; font-size: 14px; margin-top: 20px;">
                                    Mclain,<br style="margin-top: 0px; margin-bottom: 0px">
                                    Buenavista,<br style="margin-top: 0px; margin-bottom: 0px">
                                    Guimaras<br style="margin-top: 0px; margin-bottom: 0px">
                                </font>
                            </td>
                        </tr>
                        <tr valign="top">
                            <td style="text-align: center;">
                                <i class="fa fa-phone" style="font-size:16px; color: #fff"></i>
                            </td>
                            <td>
                                <font style="font-family: CENTURY GOTHIC; font-size: 14px; margin-top: 20px;">
                                    (033) 580 8244<br style="margin-top: 0px; margin-bottom: 0px">
                                </font>
                            </td>
                        </tr>
                        <tr valign="top">
                            <td style="padding-top: 10px; text-align: center;">
                                <i class="fab fa-google" style="font-size:16px; color: #fff"></i>
                            </td>
                            <td style="padding-top: 8px;">
                                <font style="font-family: CENTURY GOTHIC; font-size: 14px; margin-top: 20px;">
                                    university.president@gsu.edu.ph
                                </font>
                            </td>
                        </tr>
                        <tr valign="top">
                            <td style="padding-top: 10px; text-align: center;">
                                <i class='fab fa-facebook-f' style='font-size:16px; color: #fff'></i>
                            </td>
                            <td style="padding-top: 8px; ">
                                <font style="font-family: CENTURY GOTHIC; font-size: 14px; margin-top: 20px;">
                                    <a href="https://www.facebook.com/GuimarasStateUniversity" style="text-decoration: none; color: white">facebook.com/GuimarasStateUniversity</a>
                                    <!--Messenger Link-->
                                    <!--m.me/WeFormHearts-->
                                </font>
                            </td>
                        </tr>
                        <tr valign="top">
                            <td style="padding-right: 20px; text-align: center;">

                            </td>
                            <td style="padding-top: 40px">
                                <a class="btn btn-link text-white" href="" id="loginpage" style="font-size: 10px">Â© Copyright 2024. All Rights Reserved.</a>
                            </td>
                        </tr>
                    </table>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>


<?php
require 'database/connection.php';

$filter_school_year = isset($_GET['school_year']) ? $_GET['school_year'] : '';

$query = "SELECT DISTINCT school_year FROM tbl_deans_users_issuance ORDER BY school_year DESC";
$school_years_result = $conn->query($query);
$school_years = $school_years_result->fetchAll(PDO::FETCH_ASSOC);

$query = "SELECT * FROM tbl_deans_users_issuance";
if ($filter_school_year) {
    $query .= " WHERE school_year = :school_year";
}
$query .= " ORDER BY school_year DESC";
$stmt = $conn->prepare($query);

if ($filter_school_year) {
    $stmt->bindParam(':school_year', $filter_school_year);
}

$stmt->execute();
$schedules = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>